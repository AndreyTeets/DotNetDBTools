<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup Condition="'$(UsePackagesInSampleApplications)'!='True'">
    <GetTargetPathDependsOn>$(GetTargetPathDependsOn);GetDependencyTargetPaths</GetTargetPathDependsOn>
  </PropertyGroup>

  <Target Name="GetDependencyTargetPaths" Condition="'$(UsePackagesInSampleApplications)'!='True'">
    <ItemGroup>
      <TargetPathWithTargetPlatformMoniker Include="$(MSBuildProjectDirectory)\..\..\src\$(ProjectName)\bin\AnalyzerDebugRefAssemblies\*.dll" IncludeRuntimeDependency="false" />
    </ItemGroup>
  </Target>

  <Target Name="CopyAllOutputToRefAssemblies" AfterTargets="PostBuildEvent" Condition="'$(UsePackagesInSampleApplications)'!='True'">
    <ItemGroup>
      <FilesToCopy Include="$(TargetDir)*" />
    </ItemGroup>
    <Copy
      SourceFiles="@(FilesToCopy)"
      DestinationFolder="$(ProjectDir)bin\AnalyzerDebugRefAssemblies\"
      SkipUnchangedFiles="true" />
  </Target>

  <Target Name="DeleteMainAssemblyDllFromCopied" AfterTargets="CopyAllOutputToRefAssemblies" Condition="'$(UsePackagesInSampleApplications)'!='True'">
    <ItemGroup>
      <FilesToDelete Include="$(ProjectDir)bin\AnalyzerDebugRefAssemblies\$(TargetName).dll" />
    </ItemGroup>
    <Delete Files="@(FilesToDelete)" />
  </Target>

</Project>