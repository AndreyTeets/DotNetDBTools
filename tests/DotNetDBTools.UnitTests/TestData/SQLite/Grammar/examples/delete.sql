-- ===delete.test===
DELETE FROM test1;

SELECT * FROM table1 ORDER BY f1;

CREATE INDEX index1 ON table1(f1);

PRAGMA count_changes=on;

EXPLAIN DELETE FROM table1 WHERE f1=3;

DELETE FROM 'table1' WHERE f1=3;

SELECT * FROM table1 ORDER BY f1;

DELETE FROM table1 WHERE f1=2;

SELECT * FROM table1 ORDER BY f1;

CREATE TABLE table2(f1 int, f2 int);

DELETE FROM table2 WHERE f3=5;

DELETE FROM sqlite_master;

DELETE FROM table2 WHERE xyzzy(f1+4);

DELETE FROM table1;

SELECT count(*) FROM table1;

BEGIN TRANSACTION;

COMMIT;

SELECT count(*) FROM table1;

DELETE FROM table1;

BEGIN TRANSACTION;

COMMIT;

SELECT count(*) FROM table1;

CREATE TABLE table1(f1 int, f2 int);

PRAGMA count_changes=off;

DELETE FROM table1;

SELECT count(*) FROM table1;

BEGIN TRANSACTION;

COMMIT;

SELECT count(*) FROM table1;

SELECT count(*) FROM table1;

SELECT count(*) FROM table1;

SELECT f1 FROM table1 ORDER BY f1;

SELECT f1 FROM table1 ORDER BY f1;

INSERT INTO table1 VALUES(1,2);

SELECT f1 FROM table1 ORDER BY f1;

BEGIN; DELETE FROM table1;

DELETE FROM table2;

COMMIT;

SELECT count(*) FROM table1;

SELECT count(*) FROM table2;

SELECT f1 FROM table1 WHERE f1<10 ORDER BY f1;

SELECT f1 FROM table2 WHERE f1<10 ORDER BY f1;

DELETE FROM table1 WHERE f1>7;

SELECT f1 FROM table1 ORDER BY f1;

INSERT INTO table1 VALUES(2,4);

DELETE FROM table2 WHERE f1>7;

SELECT f1 FROM table2 ORDER BY f1;

DELETE FROM table1;

SELECT f1 FROM table1;

INSERT INTO table1 VALUES(2,3);

SELECT f1 FROM table1;

DELETE FROM table2;

SELECT f1 FROM table2;

INSERT INTO table2 VALUES(2,3);

SELECT f1 FROM table2;

INSERT INTO table1 VALUES(3,8);

CREATE TABLE t3(a);
INSERT INTO t3 VALUES(1);
INSERT INTO t3 SELECT a+1 FROM t3;
INSERT INTO t3 SELECT a+2 FROM t3;
SELECT * FROM t3;

CREATE TABLE cnt(del);
INSERT INTO cnt VALUES(0);
CREATE TRIGGER r1 AFTER DELETE ON t3 FOR EACH ROW BEGIN
UPDATE cnt SET del=del+1;
END;
DELETE FROM t3 WHERE a<2;
SELECT * FROM t3;

SELECT * FROM cnt;

DELETE FROM t3;
SELECT * FROM t3;

SELECT * FROM cnt;

INSERT INTO t3 VALUES(1);
INSERT INTO t3 SELECT a+1 FROM t3;
INSERT INTO t3 SELECT a+2 FROM t3;
CREATE TABLE t4 AS SELECT * FROM t3;
PRAGMA count_changes=ON;
DELETE FROM t3;
DELETE FROM t4;

DELETE FROM t3;

PRAGMA count_changes=OFF;
INSERT INTO t3 VALUES(123);
SELECT * FROM t3;

SELECT * FROM t3;

SELECT * FROM t3;

INSERT INTO table1 VALUES(4,16);

SELECT * FROM t3;

CREATE TABLE t5(a, b);
CREATE TABLE t6(c, d);
INSERT INTO t5 VALUES(1, 2);
INSERT INTO t5 VALUES(3, 4);
INSERT INTO t5 VALUES(5, 6);
INSERT INTO t6 VALUES('a', 'b');
INSERT INTO t6 VALUES('c', 'd');
CREATE INDEX i5 ON t5(a);
CREATE INDEX i6 ON t6(c);

SELECT t5.rowid AS r, c, d FROM t5, t6 ORDER BY a;

DELETE FROM t5;

INSERT INTO t5 VALUES(1, 2);
INSERT INTO t5 VALUES(3, 4);
INSERT INTO t5 VALUES(5, 6);

SELECT t5.rowid AS r, c, d FROM t5, t6 ORDER BY a;

DELETE FROM t5 WHERE rowid = 2;

DELETE FROM t5;
INSERT INTO t5 VALUES(1, 2);
INSERT INTO t5 VALUES(3, 4);
INSERT INTO t5 VALUES(5, 6);

SELECT t5.rowid AS r, c, d FROM t5, t6 ORDER BY a;

DELETE FROM t5 WHERE rowid = 1;

SELECT * FROM table1 ORDER BY f1;

DELETE FROM t5;
INSERT INTO t5 VALUES(1, 2);
INSERT INTO t5 VALUES(3, 4);
INSERT INTO t5 VALUES(5, 6);

SELECT t5.rowid AS r, c, d FROM t5, t6 ORDER BY a;

DELETE FROM t5 WHERE rowid = 3;

DELETE FROM table1 WHERE f1=3;

-- ===delete2.test===
CREATE TABLE q(s string, id string, constraint pk_q primary key(id));
BEGIN;
INSERT INTO q(s,id) VALUES('hello','id.1');
INSERT INTO q(s,id) VALUES('goodbye','id.2');
INSERT INTO q(s,id) VALUES('again','id.3');
END;
SELECT * FROM q;

SELECT * FROM q WHERE id='id.1';

SELECT * FROM q;

SELECT * FROM q;

CREATE TABLE t1(a, b);
CREATE TABLE t2(c, d);
INSERT INTO t1 VALUES(1, 2);
INSERT INTO t2 VALUES(3, 4);
INSERT INTO t2 VALUES(5, 6);

SELECT CASE WHEN c = 5 THEN b ELSE NULL END AS b, c, d FROM t1, t2;

DELETE FROM t1;

-- ===delete3.test===
CREATE TABLE t1(x integer primary key);
BEGIN;
INSERT INTO t1 VALUES(1);
INSERT INTO t1 VALUES(2);
INSERT INTO t1 SELECT x+2 FROM t1;
INSERT INTO t1 SELECT x+4 FROM t1;
INSERT INTO t1 SELECT x+8 FROM t1;
INSERT INTO t1 SELECT x+16 FROM t1;
INSERT INTO t1 SELECT x+32 FROM t1;
INSERT INTO t1 SELECT x+64 FROM t1;
INSERT INTO t1 SELECT x+128 FROM t1;
INSERT INTO t1 SELECT x+256 FROM t1;
INSERT INTO t1 SELECT x+512 FROM t1;
INSERT INTO t1 SELECT x+1024 FROM t1;
INSERT INTO t1 SELECT x+2048 FROM t1;
INSERT INTO t1 SELECT x+4096 FROM t1;
INSERT INTO t1 SELECT x+8192 FROM t1;
INSERT INTO t1 SELECT x+16384 FROM t1;
INSERT INTO t1 SELECT x+32768 FROM t1;
INSERT INTO t1 SELECT x+65536 FROM t1;
INSERT INTO t1 SELECT x+131072 FROM t1;
INSERT INTO t1 SELECT x+262144 FROM t1;
COMMIT;
SELECT count(*) FROM t1;

DELETE FROM t1 WHERE x%2==0;
SELECT count(*) FROM t1;