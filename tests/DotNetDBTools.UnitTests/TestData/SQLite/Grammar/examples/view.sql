-- ===view.test===
CREATE TABLE t1(a,b,c);
INSERT INTO t1 VALUES(1,2,3);
INSERT INTO t1 VALUES(4,5,6);
INSERT INTO t1 VALUES(7,8,9);
SELECT * FROM t1;

SELECT x FROM v2 WHERE a>10;

SELECT 1 FROM t1 LIMIT 1;

SELECT 1 FROM v1 LIMIT 1;

CREATE TABLE t2(y,a);
INSERT INTO t2 VALUES(22,2);
INSERT INTO t2 VALUES(33,3);
INSERT INTO t2 VALUES(44,4);
INSERT INTO t2 VALUES(55,5);
SELECT * FROM t2;

CREATE VIEW v5 AS
SELECT t1.x AS v, t2.y AS w FROM t1 JOIN t2 USING(a);
SELECT * FROM v5;

EXPLAIN SELECT * FROM v5;

SELECT * FROM v5 AS a, t2 AS b WHERE a.w=b.y;

EXPLAIN SELECT * FROM v5 AS a, t2 AS b WHERE a.w=b.y;

SELECT * FROM t2 AS b, v5 AS a WHERE a.w=b.y;

EXPLAIN SELECT * FROM t2 AS b, v5 AS a WHERE a.w=b.y;

BEGIN;
CREATE VIEW IF NOT EXISTS v1 AS SELECT a,b FROM t1;
SELECT * FROM v1 ORDER BY a;

SELECT * FROM t1 AS a, v5 AS b, t2 AS c WHERE a.x=b.v AND b.w=c.y;

EXPLAIN SELECT * FROM t1 AS a, v5 AS b, t2 AS c WHERE a.x=b.v AND b.w=c.y;

SELECT min(x), min(a), min(b), min(c), min(a+b+c) FROM v2;

SELECT max(x), max(a), max(b), max(c), max(a+b+c) FROM v2;

CREATE TABLE test1(id integer primary key, a);
CREATE TABLE test2(id integer, b);
INSERT INTO test1 VALUES(1,2);
INSERT INTO test2 VALUES(1,3);
CREATE VIEW test AS
SELECT test1.id, a, b
FROM test1 JOIN test2 ON test2.id=test1.id;
SELECT * FROM test;

SELECT * FROM test;

DROP VIEW test;
CREATE VIEW test AS
SELECT test1.id, a, b
FROM test1 JOIN test2 USING(id);
SELECT * FROM test;

SELECT * FROM test;

DROP VIEW test;
CREATE VIEW test AS
SELECT test1.id, a, b
FROM test1 NATURAL JOIN test2;
SELECT * FROM test;

SELECT * FROM test;

CREATE VIEW v1 AS SELECT a,b FROM t1;
SELECT * FROM v1 ORDER BY a;

CREATE VIEW v6 AS SELECT pqr, xyz FROM v1;
SELECT * FROM v6 ORDER BY xyz;

SELECT * FROM v6 ORDER BY xyz;

CREATE VIEW v7 AS SELECT pqr+xyz AS a FROM v6;
SELECT * FROM v7 ORDER BY a;

CREATE VIEW v8 AS SELECT max(cnt) AS mx FROM
(SELECT a%2 AS eo, count(*) AS cnt FROM t1 GROUP BY eo);
SELECT * FROM v8;

SELECT mx+10, mx*2 FROM v8;

SELECT mx+10, pqr FROM v6, v8 WHERE xyz=2;

SELECT mx+10, pqr FROM v6, v8 WHERE xyz>2;

INSERT INTO t2 SELECT * FROM t2 WHERE a<5;
INSERT INTO t2 SELECT * FROM t2 WHERE a<4;
INSERT INTO t2 SELECT * FROM t2 WHERE a<3;
SELECT DISTINCT count(*) FROM t2 GROUP BY a ORDER BY 1;

SELECT DISTINCT count(*) FROM t2 GROUP BY a ORDER BY 1 LIMIT 3;

CREATE VIEW v9 AS 
SELECT DISTINCT count(*) FROM t2 GROUP BY a ORDER BY 1 LIMIT 3;
SELECT * FROM v9;

SELECT * FROM v1 ORDER BY a;

SELECT * FROM v9 ORDER BY 1 DESC;

CREATE VIEW v10 AS 
SELECT DISTINCT a, count(*) FROM t2 GROUP BY a ORDER BY 2 LIMIT 3;
SELECT * FROM v10;

SELECT * FROM v10 ORDER BY 1;

CREATE TABLE t3("9" integer, [4] text);
INSERT INTO t3 VALUES(1,2);
CREATE VIEW v_t3_a AS SELECT a.[9] FROM t3 AS a;
CREATE VIEW v_t3_b AS SELECT "4" FROM t3;
SELECT * FROM v_t3_a;

SELECT * FROM v_t3_b;

CREATE TABLE t4(a COLLATE NOCASE);
INSERT INTO t4 VALUES('This');
INSERT INTO t4 VALUES('this');
INSERT INTO t4 VALUES('THIS');
SELECT * FROM t4 WHERE a = 'THIS';

SELECT * FROM (SELECT * FROM t4) WHERE a = 'THIS';

CREATE VIEW v11 AS SELECT * FROM t4;
SELECT * FROM v11 WHERE a = 'THIS';

SELECT sql FROM sqlite_master WHERE name='v1';

DROP VIEW t1;
DROP TABLE t1;
CREATE TABLE t1(a, b, c);
INSERT INTO t1 VALUES(1, 2, 3);
INSERT INTO t1 VALUES(4, 5, 6);
CREATE VIEW vv1 AS SELECT * FROM t1;
CREATE VIEW vv2 AS SELECT * FROM vv1;
CREATE VIEW vv3 AS SELECT * FROM vv2;
CREATE VIEW vv4 AS SELECT * FROM vv3;
CREATE VIEW vv5 AS SELECT * FROM vv4;
SELECT * FROM vv5;

CREATE VIEW v1 AS SELECT a,b FROM t1;
SELECT * FROM v1 ORDER BY a;

CREATE VIEW v3308a AS SELECT rowid, * FROM t1;

CREATE VIEW v3308b AS SELECT t1.rowid, t1.a, t1.b+t1.c FROM t1;

CREATE VIEW v3308c AS SELECT t1.oid, A, t1.b+t1.c AS x FROM t1;

DROP TABLE IF EXISTS t1;
DROP VIEW IF EXISTS v1;
CREATE TABLE t1(c1);
CREATE VIEW v1 AS SELECT c1 FROM (SELECT t1.c1 FROM t1);

CREATE TABLE t1(x,a,b,c);
INSERT INTO t1 VALUES(1,2,3,4);
INSERT INTO t1 VALUES(4,5,6,7);
INSERT INTO t1 VALUES(7,8,9,10);
SELECT * FROM v1 ORDER BY a;

SELECT * FROM v1 ORDER BY a;

CREATE VIEW v2 AS SELECT * FROM t1 WHERE a>5;

INSERT INTO t1 VALUES(11,12,13,14);
SELECT * FROM v2 ORDER BY x;