-- ===update.test===
UPDATE test1 SET f2=5 WHERE f1<1;

SELECT * FROM test1 ORDER BY f1;

SELECT * FROM test1 WHERE f1==88 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2>800;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2<800;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f2==89 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f2==88 ORDER BY f1,f2;

UPDATE test1 SET f1=f1+1 WHERE f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

PRAGMA count_changes=on;

SELECT * FROM test1 WHERE f1==78 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET f1=f1-1 WHERE f1>100 and f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==78 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==777 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET f1=f1-1 WHERE f1<=100 and f2==128;

UPDATE test1 SET f2=f2/3 WHERE f1<=5;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==77 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==777 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET x=11 WHERE f1=1025;

UPDATE test1 SET f1=x(11) WHERE f1=1025;

UPDATE test1 SET f1=11 WHERE x=1025;

UPDATE test1 SET f1=11 WHERE x(f1)=1025;

DROP TABLE test1;
CREATE TABLE t1(
a integer primary key,
b UNIQUE, 
c, d,
e, f,
UNIQUE(c,d)
);
INSERT INTO t1 VALUES(1,2,3,4,5,6);
INSERT INTO t1 VALUES(2,3,4,4,6,7);
SELECT * FROM t1;

SELECT * FROM test1 ORDER BY f1;

UPDATE t1 SET e=e+1 WHERE b IN (SELECT b FROM t1);
SELECT b,e FROM t1;

UPDATE t1 SET e=e+1 WHERE a IN (SELECT a FROM t1);
SELECT a,e FROM t1;

BEGIN;
CREATE TABLE t2(a);
INSERT INTO t2 VALUES(1);
INSERT INTO t2 VALUES(2);
INSERT INTO t2 SELECT a+2 FROM t2;
INSERT INTO t2 SELECT a+4 FROM t2;
INSERT INTO t2 SELECT a+8 FROM t2;
INSERT INTO t2 SELECT a+16 FROM t2;
INSERT INTO t2 SELECT a+32 FROM t2;
INSERT INTO t2 SELECT a+64 FROM t2;
INSERT INTO t2 SELECT a+128 FROM t2;
INSERT INTO t2 SELECT a+256 FROM t2;
INSERT INTO t2 SELECT a+512 FROM t2;
INSERT INTO t2 SELECT a+1024 FROM t2;
COMMIT;
SELECT count(*) FROM t2;

SELECT count(*) FROM t2 WHERE a=rowid;

UPDATE t2 SET rowid=rowid-1;
SELECT count(*) FROM t2 WHERE a=rowid+1;

UPDATE t2 SET rowid=rowid+10000;
UPDATE t2 SET rowid=rowid-9999;
SELECT count(*) FROM t2 WHERE a=rowid;

BEGIN;
INSERT INTO t2 SELECT a+2048 FROM t2;
INSERT INTO t2 SELECT a+4096 FROM t2;
INSERT INTO t2 SELECT a+8192 FROM t2;
SELECT count(*) FROM t2 WHERE a=rowid;
COMMIT;

UPDATE t2 SET rowid=rowid-1;
SELECT count(*) FROM t2 WHERE a=rowid+1;

CREATE TABLE t3(a,b,c);
CREATE TRIGGER t3r1 BEFORE UPDATE on t3 WHEN nosuchcol BEGIN
SELECT 'illegal WHEN clause';
END;

CREATE TABLE t4(a,b,c);
CREATE TRIGGER t4r1 AFTER UPDATE on t4 WHEN nosuchcol BEGIN
SELECT 'illegal WHEN clause';
END;

UPDATE test1 SET f2=f2/3 WHERE f1>5;

SELECT * FROM test1 ORDER BY f1;

UPDATE test1 SET F2=f1, F1=f2;

SELECT * FROM test1 ORDER BY F1;

PRAGMA count_changes=off;

UPDATE test1 SET F2=f1, F1=f2;

UPDATE sqlite_master SET name='xyz' WHERE name='123';

SELECT * FROM test1 ORDER BY F1;

DELETE FROM test1 WHERE f1<=5;
INSERT INTO test1(f1,f2) VALUES(8,88);
INSERT INTO test1(f1,f2) VALUES(8,888);
INSERT INTO test1(f1,f2) VALUES(77,128);
INSERT INTO test1(f1,f2) VALUES(777,128);

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2+1 WHERE f1==8;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2>800;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2<800;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f1=f1+1 WHERE f2==128;

CREATE TABLE test1(f1 int,f2 int);

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f1=f1-1 WHERE f1>100 and f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

PRAGMA count_changes=on;
UPDATE test1 SET f1=f1-1 WHERE f1<=100 and f2==128;

PRAGMA count_changes=off;
SELECT * FROM test1 ORDER BY f1,f2;

CREATE INDEX idx1 ON test1(f1);

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2+1 WHERE f1==8;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2>800;

SELECT * FROM test1 ORDER BY f1;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2<800;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f1=f1+1 WHERE f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==78 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET f1=f1-1 WHERE f1>100 and f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f1=f3*2 WHERE f2==32;

SELECT * FROM test1 WHERE f1==78 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==777 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

PRAGMA count_changes=on;
UPDATE test1 SET f1=f1-1 WHERE f1<=100 and f2==128;

PRAGMA count_changes=off;
SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==77 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==777 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET f1=test2.f1*2 WHERE f2==32;

PRAGMA synchronous=FULL;

DROP INDEX idx1;

CREATE INDEX idx1 ON test1(f2);

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2+1 WHERE f1==8;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f2==89 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==88 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2>800;

UPDATE test1 SET f3=f1*2 WHERE f2==32;

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2-1 WHERE f1==8 and f2<800;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f2==89 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f2==88 ORDER BY f1,f2;

UPDATE test1 SET f1=f1+1 WHERE f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==78 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

UPDATE test1 SET f2=f2*3;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET f1=f1-1 WHERE f1>100 and f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==78 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==777 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

UPDATE test1 SET f1=f1-1 WHERE f1<=100 and f2==128;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==77 ORDER BY f1,f2;

SELECT count(*) FROM test1;

SELECT * FROM test1 WHERE f1==778 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==777 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

CREATE INDEX idx2 ON test1(f2);

CREATE INDEX idx3 ON test1(f1,f2);

SELECT * FROM test1 ORDER BY f1,f2;

UPDATE test1 SET f2=f2+1 WHERE f1==8;

SELECT * FROM test1 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f1==8 ORDER BY f1,f2;

SELECT * FROM test1 WHERE f2==89 ORDER BY f1,f2